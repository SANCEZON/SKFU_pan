# Деплой на TimeWeb Shared Hosting

## ⚠️ Важное ограничение

На обычном shared hosting **НЕТ** поддержки Node.js и Docker. Это означает, что **API сервер (Express.js) нельзя запустить** на shared hosting.

## Варианты решения

### Вариант 1: Использовать внешний API (рекомендуется для начала)

Разместить API на отдельном бесплатном хостинге:
- **Railway.app** (бесплатный tier)
- **Render.com** (бесплатный tier)
- **Fly.io** (бесплатный tier)
- Отдельный VPS TimeWeb (если есть)

**Плюсы:**
- Быстрый деплой
- Не нужно переписывать код
- Бесплатные варианты доступны

**Минусы:**
- API на другом сервере
- Нужна настройка CORS

### Вариант 2: Переписать API на PHP

Переписать весь API с Node.js/Express на PHP.

**Плюсы:**
- Все на одном сервере
- Полный контроль

**Минусы:**
- Много работы (переписать все роуты)
- Нужно знание PHP

### Вариант 3: Взять VPS на TimeWeb

VPS позволяет установить Docker и Node.js.

**Плюсы:**
- Все работает как сейчас
- Полный контроль
- Можно использовать текущий код без изменений

**Минусы:**
- Платно (обычно от 200-300₽/месяц)

## Что можно сделать на Shared Hosting

✅ Разместить фронтенд (статический сайт)
✅ Использовать MySQL базу данных
✅ Использовать phpMyAdmin для управления БД

❌ Запустить Node.js API
❌ Использовать Docker

## Инструкция по деплою фронтенда на Shared Hosting

### Шаг 1: Подготовка (уже сделано)

- ✅ Создан `.htaccess` для SPA
- ✅ Фронтенд собран в `dist/`

### Шаг 2: Сборка фронтенда для production

Выполните локально:

```bash
# Установите зависимости (если еще не установлены)
pnpm install

# Создайте файл .env.production с URL вашего API
echo "VITE_API_URL=http://YOUR_API_URL" > .env.production

# Соберите проект
pnpm build --mode production
```

**Важно:** Замените `YOUR_API_URL` на реальный URL вашего API сервера.

### Шаг 3: Загрузка файлов на хостинг

1. Откройте FTP клиент (FileZilla, WinSCP и т.д.)
2. Подключитесь к серверу:
   - **Хост:** `vh456.timeweb.ru` (или IP: `92.53.96.141`)
   - **Логин:** `barebuch`
   - **Пароль:** пароль от панели управления
   - **Порт:** 21 (FTP)

3. Загрузите содержимое папки `dist/` в корневую директорию сайта (обычно `public_html` или `www`)

4. Загрузите файл `.htaccess` в ту же директорию

### Шаг 4: Настройка базы данных MySQL

1. Войдите в панель TimeWeb
2. Перейдите в "Базы данных MySQL"
3. Создайте новую базу данных:
   - Название: `attendance_db` (или любое другое)
   - Запомните логин и пароль (они будут показаны)

4. Откройте phpMyAdmin (кнопка в панели)
5. Выберите созданную базу данных
6. Перейдите на вкладку "SQL"
7. Скопируйте содержимое файла `database/schema.sql` и выполните его
8. (Опционально) Выполните `database/init.sql` для начальных данных

### Шаг 5: Настройка API (если используете внешний хостинг)

Если вы используете внешний API (Railway, Render и т.д.):

1. Создайте файл `api/.env` на сервере API:
```env
DB_HOST=vh456.timeweb.ru
DB_PORT=3306
DB_USER=ваш_логин_БД
DB_PASSWORD=ваш_пароль_БД
DB_NAME=attendance_db
JWT_SECRET=случайный_секретный_ключ
PORT=3000
NODE_ENV=production
```

2. Обновите `VITE_API_URL` в `.env.production` на URL вашего API

### Шаг 6: Проверка работы

1. Откройте ваш сайт: `http://92.53.96.141` (или домен, если настроен)
2. Проверьте, что фронтенд загружается
3. Проверьте, что API доступен (откройте DevTools → Network)

## Настройка CORS для внешнего API

Если API на другом сервере, нужно настроить CORS в `api/src/index.ts`:

```typescript
app.use(cors({
  origin: ['http://92.53.96.141', 'http://your-domain.com'],
  credentials: true
}))
```

## Рекомендация

Для полноценной работы **рекомендую взять VPS на TimeWeb** (от 200-300₽/месяц), так как:
- Можно использовать весь текущий код без изменений
- Все на одном сервере
- Полный контроль
- Docker и Node.js работают из коробки

Если бюджет ограничен, используйте **Railway.app** или **Render.com** для API (бесплатно).

## Деплой API на Railway.app (бесплатно)

1. Зарегистрируйтесь на https://railway.app
2. Создайте новый проект
3. Подключите GitHub репозиторий
4. Выберите папку `api/`
5. Настройте переменные окружения:
   - `DB_HOST` - хост MySQL (TimeWeb)
   - `DB_PORT` - 3306
   - `DB_USER` - логин БД
   - `DB_PASSWORD` - пароль БД
   - `DB_NAME` - название БД
   - `JWT_SECRET` - случайный ключ
6. Railway автоматически задеплоит API
7. Получите URL API (например: `https://your-api.railway.app`)
8. Используйте этот URL в `VITE_API_URL`

## Деплой API на Render.com (бесплатно)

1. Зарегистрируйтесь на https://render.com
2. Создайте новый "Web Service"
3. Подключите GitHub репозиторий
4. Настройки:
   - **Root Directory:** `api`
   - **Build Command:** `npm install && npm run build`
   - **Start Command:** `npm start`
5. Настройте переменные окружения (как в Railway)
6. Получите URL API
7. Используйте в `VITE_API_URL`

