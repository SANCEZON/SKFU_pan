# Пошаговая инструкция по деплою

## Текущая ситуация

У вас **обычный shared hosting** на TimeWeb, который имеет:
- ✅ MySQL базы данных (0 из 2 использовано)
- ✅ phpMyAdmin
- ✅ FTP доступ
- ❌ Нет Node.js (нельзя запустить API)
- ❌ Нет Docker

## Что уже подготовлено

✅ Создан файл `.htaccess` для правильной работы SPA
✅ Подготовлена инструкция в `DEPLOY_SHARED_HOSTING.md`

## Варианты действий

### Вариант A: Взять VPS (рекомендуется)

**Плюсы:**
- Можно использовать весь текущий код
- Все на одном сервере
- Docker и Node.js работают

**Стоимость:** ~200-300₽/месяц

**Действия:**
1. В панели TimeWeb перейдите в "VDS/VPS Серверы"
2. Создайте новый VPS (минимальная конфигурация)
3. Следуйте инструкции из плана деплоя для VPS

### Вариант B: Использовать внешний API (бесплатно)

**Плюсы:**
- Бесплатно
- Быстрый деплой

**Минусы:**
- API на другом сервере
- Нужна настройка CORS

**Действия:**

#### Шаг 1: Разместить API на Railway.app (бесплатно)

1. Зайдите на https://railway.app
2. Войдите через GitHub
3. Нажмите "New Project" → "Deploy from GitHub repo"
4. Выберите репозиторий `SKFU_pan`
5. В настройках проекта:
   - **Root Directory:** укажите `api`
   - Railway автоматически определит Node.js проект
6. Перейдите в "Variables" и добавьте:
   ```
   DB_HOST=vh456.timeweb.ru
   DB_PORT=3306
   DB_USER=ваш_логин_БД_из_TimeWeb
   DB_PASSWORD=ваш_пароль_БД_из_TimeWeb
   DB_NAME=attendance_db
   JWT_SECRET=сгенерируйте_случайную_строку
   PORT=3000
   NODE_ENV=production
   ```
7. Railway автоматически задеплоит API
8. После деплоя получите URL (например: `https://your-api.up.railway.app`)
9. Скопируйте этот URL

#### Шаг 2: Настроить базу данных на TimeWeb

1. В панели TimeWeb → "Базы данных MySQL"
2. Нажмите "Создать базу данных"
3. Запомните:
   - Название БД (например: `barebuch_attendance`)
   - Логин (обычно совпадает с названием БД)
   - Пароль (будет показан)
4. Откройте phpMyAdmin (кнопка в панели)
5. Выберите созданную БД
6. Вкладка "SQL" → вставьте содержимое `database/schema.sql` → "Выполнить"
7. (Опционально) Выполните `database/init.sql`

#### Шаг 3: Обновить настройки API на Railway

Вернитесь в Railway и обновите переменные окружения с реальными данными из TimeWeb:
- `DB_USER` - логин БД из TimeWeb
- `DB_PASSWORD` - пароль БД из TimeWeb
- `DB_NAME` - название БД из TimeWeb

#### Шаг 4: Настроить CORS в API

Нужно разрешить запросы с вашего хостинга. В файле `api/src/index.ts` измените:

```typescript
app.use(cors({
  origin: ['http://92.53.96.141', 'http://vh456.timeweb.ru'],
  credentials: true
}))
```

Затем пересоберите и задеплойте на Railway (автоматически при push в GitHub).

#### Шаг 5: Собрать фронтенд

Локально выполните:

```bash
# Создайте .env.production
echo "VITE_API_URL=https://your-api.up.railway.app" > .env.production

# Соберите проект
pnpm build --mode production
```

**Важно:** Замените `https://your-api.up.railway.app` на реальный URL из Railway.

#### Шаг 6: Загрузить фронтенд на TimeWeb

1. Откройте FileZilla (или другой FTP клиент)
2. Подключитесь:
   - Хост: `vh456.timeweb.ru` или `92.53.96.141`
   - Логин: `barebuch`
   - Пароль: пароль от панели TimeWeb
   - Порт: 21
3. Перейдите в `public_html` (или `www`)
4. Загрузите **все файлы** из папки `dist/`
5. Загрузите файл `.htaccess` в ту же директорию

#### Шаг 7: Проверка

1. Откройте `http://92.53.96.141` в браузере
2. Откройте DevTools (F12) → вкладка Network
3. Попробуйте войти/зарегистрироваться
4. Проверьте, что запросы к API идут на Railway

## Если что-то не работает

### Фронтенд не загружается
- Проверьте, что файлы загружены в правильную директорию
- Проверьте, что `.htaccess` на месте
- Проверьте права доступа к файлам (должны быть 644)

### API не отвечает
- Проверьте логи на Railway
- Проверьте переменные окружения
- Проверьте, что БД доступна с Railway (может быть заблокирован внешний доступ)

### Ошибка CORS
- Убедитесь, что в API настроен правильный origin
- Пересоберите и задеплойте API

### База данных недоступна
- Проверьте, что MySQL на TimeWeb разрешает внешние подключения
- Возможно, нужно разрешить IP Railway в настройках БД TimeWeb

## Следующие шаги

После успешного деплоя:
1. Настройте домен (если есть) в панели TimeWeb
2. Создайте первого пользователя через регистрацию
3. Одобрите пользователя в панели приглашений

## Рекомендация

Если планируете активно использовать систему, **рекомендую взять VPS** - это проще и надежнее для долгосрочного использования.

